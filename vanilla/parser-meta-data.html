<html>
<head>
  <title>teste</title>
</head>
<body>
    <div itemscope itemtype="http://schema.org/Person">
      <span itemprop="name">Jane Doe</span>
      <img src="janedoe.jpg" itemprop="image" />

      <span itemprop="jobTitle">Professor</span>
      <div itemprop="address" itemscope itemtype="http://schema.org/PostalAddress">
        <span itemprop="streetAddress">
          20341 Whitworth Institute
          405 N. Whitworth
        </span>
        <span itemprop="addressLocality">Seattle</span>,
        <span itemprop="addressRegion">WA</span>
        <span itemprop="postalCode">98052</span>
      </div>

      <span itemprop="telephone">(425) 123-4567</span>
      <a href="mailto:jane-doe@xyz.edu" itemprop="email">
        jane-doe@xyz.edu</a>
      Jane's home page:
      <a href="http://www.janedoe.com" itemprop="url">janedoe.com</a>

      Graduate students:
      <a href="http://www.xyz.edu/students/alicejones.html" itemprop="colleague">
        Alice Jones</a>
      <a href="http://www.xyz.edu/students/bobsmith.html" itemprop="colleague">
        Bob Smith</a>
    </div>
</body>
<script>
]
"use strict";
var scrapper = {
    obj:[],
    DoomTree: document.cloneNode(true),
    getEntity: function(frag, type){
        var all = frag.querySelectorAll("*");
        var context;
        for (var x in all){
            if(all[x].getAttribute && all[x].getAttribute(type)!== null){
                context = all[x]; 
                context.parentNode.removeChild(context);
                return context;
                break;
            }
        }
        return false;
    }, 
    getScopes: function(obj){
      var tree = [],
          node = true;
      while(node){
        node = this.getEntity(obj, "itemtype");
        if(node){
          var itemType = this.getItemType(node),
              newNode = {};
          newNode.itemType = itemType;
          newNode.htmlText = node.outerHTML;
          newNode = this.getProps(newNode, node);
          //tree[itemType] = newNode;
          tree.push(newNode)
        };
      }
      return tree;
    },
    parseProps:  function(props){
      var value = (props.firstChild!== null)? props.firstChild.textContent :  false;
      var obj = {
          html : props.innerHTML || false,
          value: value,
          itemprop : props.getAttribute("itemprop") || false,
          href : props.getAttribute("href") || false,
          content: props.getAttribute("content") || false,
          src: props.getAttribute("src") || false
      };
      var tmp = {};
      for (var x in obj){
        if(obj[x]){
          tmp[x] = obj[x];
        }
      }
      return tmp;
    },
    getProps: function(obj, props){
      var p = props.querySelectorAll("*"),
          x = p.length,
          find = "itemprop";

      while(x--){
        if(p[x]){
            obj[p[x].getAttribute(find)] = this.parseProps(p[x]);
        }
      }
      return obj;
    },
    getItemType: function(obj){
      var objName = obj.getAttribute("itemtype");
          return objName.substring((objName.lastIndexOf("/")+1), objName.length).toLowerCase();
    },
    generateNode: function(prop, value){
        var node = {};
        node[prop] = {};
        return node[prop];
    },
    genereteTree: function(entity){
      var obj = entity || this.DoomTree.getElementsByTagName("html")[0],
          tree = {};
      // trata o primeiro ciclo
      if(obj.tagName === "HTML"){
        obj = this.getEntity(obj, "itemtype");
        if(obj){
           var objName = this.getItemType(obj);
        }
      };
      //
      if(obj){
        tree[objName]= this.getScopes(obj);
        tree[objName] = this.getProps(tree[objName], obj);
      }
      //
      return tree;
    },
    get: function(){
        var obj = this.obj,
            entity = this.genereteTree();
        return entity;
    }
};
console.log(scrapper.get());
